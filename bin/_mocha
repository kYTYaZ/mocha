#!/usr/bin/env node
'use strict';

/* eslint no-unused-vars: off */

/**
 * Module dependencies.
 */

const symbols = require('log-symbols');
const yargs = require('yargs');
const path = require('path');
const getOptions = require('../lib/cli/options');
const commands = require('../lib/cli/commands');
const chalk = require('chalk');

// ensure we can require() from current working directory
module.paths.push(process.cwd(), path.resolve('node_modules'));

// If not already done, load mocha.opts
if (!process.env.LOADED_MOCHA_OPTS) {
  getOptions();
}

Error.stackTraceLimit = Infinity; // configurable via --stack-trace-limit?

yargs
  .scriptName('mocha')
  .command(commands.run)
  .command(commands.init)
  .alias('help', 'h')
  .updateStrings({
    'Positionals:': 'Positional Arguments',
    'Options:': 'Other Options'
  })
  .fail((msg, err, yargs) => {
    yargs.showHelp();
    console.error(`\n${symbols.error} ${chalk.red('ERROR:')} ${msg}`);
  })
  .epilog(`Read the docs at ${chalk.yellow('https://mochajs.org')}`)
  .parse();
